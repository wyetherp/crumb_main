// ===== LIBRARIES =====
#include <WiFi.h>       // For WiFi connection
#include <HTTPClient.h> // For sending web requests

// ===== WIFI CREDENTIALS =====
const char* ssid = "YOUR_WIFI_NAME";           // Your WiFi name
const char* password = "YOUR_WIFI_PASSWORD";     // Your WiFi password

// ===== DISCORD WEBHOOK =====
const char* webhookURL = "YOUR_WEBHOOK_HERE"; //You can find your discord webhook in settings 

// ===== PIN SETUP =====
const int buttonPin = 14;  // Button connected to GPIO 14

// ===== VARIABLES =====
bool lastButtonState = HIGH;  // Track previous button state
bool messageSent = false;      // Prevent multiple sends

// ===== SETUP (runs once) =====
void setup() {
  Serial.begin(115200);           // Start serial monitor (to see what's happening)
  pinMode(buttonPin, INPUT_PULLUP); // Set button pin as input with pullup resistor
  
  // Connect to WiFi
  Serial.print("Connecting to WiFi");
  WiFi.begin(ssid, password);
  
  // Wait until connected
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");  // Print dots while connecting
  }
  
  Serial.println("\nWiFi Connected!");
  Serial.print("IP Address: ");
  Serial.println(WiFi.localIP());  // Print the IP address (just for info)
}

// ===== LOOP (runs forever) =====
void loop() {
  int buttonState = digitalRead(buttonPin);  // Read button (LOW = pressed, HIGH = not pressed)
  
  // Check if button was just pressed (changed from HIGH to LOW)
  if (buttonState == LOW && lastButtonState == HIGH && !messageSent) {
    Serial.println("Button pressed! Sending message...");
    sendDiscordMessage("Hey I miss you ðŸ’™");  // Send the message
    messageSent = true;  // Mark as sent to prevent spam
  }
  
  // Reset when button is released
  if (buttonState == HIGH) {
    messageSent = false;  // Allow sending again on next press
  }
  
  lastButtonState = buttonState;  // Remember this state for next loop
  delay(50);  // Small delay to debounce button (prevent bouncing)
}

// ===== SEND MESSAGE TO DISCORD =====
void sendDiscordMessage(String message) {
  // Check if WiFi is still connected
  if (WiFi.status() == WL_CONNECTED) {
    HTTPClient http;  // Create HTTP client
    
    http.begin(webhookURL);  // Connect to Discord webhook
    http.addHeader("Content-Type", "application/json");  // Tell Discord we're sending JSON
    
    // Create JSON message (Discord webhook format)
    String jsonMessage = "{\"content\":\"" + message + "\"}";
    
    // Send the message
    int httpResponseCode = http.POST(jsonMessage);
    
    // Check if it worked
    if (httpResponseCode > 0) {
      Serial.println("Message sent successfully!");
      Serial.print("Response code: ");
      Serial.println(httpResponseCode);  // 204 = success for Discord
    } else {
      Serial.println("Error sending message");
      Serial.print("Error code: ");
      Serial.println(httpResponseCode);
    }
    
    http.end();  // Close connection
  } else {
    Serial.println("WiFi not connected!");
  }
}
